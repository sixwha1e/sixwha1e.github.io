<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>PHP大法好—&gt;安全的代码 | sixwhale&#39;s pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="0x00 首先目前在深入的学习PHP中 自己是个学安全的 所以对于代码的安全较为敏感 网站的的漏洞源于代码的漏洞 白盒狗专注代码漏洞挖掘30年
学好代码审计的关键也是写好代码的关键:
了解恶意用户要从哪些入口攻击整个框架 
一切输入都是有害的
不要信任任何一个用户
代码的逻辑

0x01 过滤输入a.验证提交值是否为期望值或者允许值&amp;lt;html&amp;gt;&amp;lt;form action=&quot;&quot; me">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP大法好—>安全的代码">
<meta property="og:url" content="http://yoursite.com/2015/12/03/php大法好—>安全的代码/index.html">
<meta property="og:site_name" content="sixwhale's pages">
<meta property="og:description" content="0x00 首先目前在深入的学习PHP中 自己是个学安全的 所以对于代码的安全较为敏感 网站的的漏洞源于代码的漏洞 白盒狗专注代码漏洞挖掘30年
学好代码审计的关键也是写好代码的关键:
了解恶意用户要从哪些入口攻击整个框架 
一切输入都是有害的
不要信任任何一个用户
代码的逻辑

0x01 过滤输入a.验证提交值是否为期望值或者允许值&amp;lt;html&amp;gt;&amp;lt;form action=&quot;&quot; me">
<meta property="og:updated_time" content="2016-02-16T07:45:53.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PHP大法好—>安全的代码">
<meta name="twitter:description" content="0x00 首先目前在深入的学习PHP中 自己是个学安全的 所以对于代码的安全较为敏感 网站的的漏洞源于代码的漏洞 白盒狗专注代码漏洞挖掘30年
学好代码审计的关键也是写好代码的关键:
了解恶意用户要从哪些入口攻击整个框架 
一切输入都是有害的
不要信任任何一个用户
代码的逻辑

0x01 过滤输入a.验证提交值是否为期望值或者允许值&amp;lt;html&amp;gt;&amp;lt;form action=&quot;&quot; me">
  
    <link rel="alternate" href="/atom.xml" title="sixwhale&#39;s pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css" type="text/css">
</head>

  
    
      <body>
    
  
      <div id="container" class="container">
        <article id="post-php大法好—&gt;安全的代码" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/about">About</a>
    
      <a class="main-nav-link" href="/blogroll">Links</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PHP大法好—&gt;安全的代码
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <h2 id="0x00_首先">0x00 首先</h2><p>目前在深入的学习PHP中 自己是个学安全的 所以对于代码的安全较为敏感 网站的的漏洞源于代码的漏洞 <strong>白盒狗专注代码漏洞挖掘30年</strong></p>
<h4 id="学好代码审计的关键也是写好代码的关键:">学好代码审计的关键也是写好代码的关键:</h4><ul>
<li>了解恶意用户要从哪些入口攻击整个框架 </li>
<li>一切输入都是有害的</li>
<li>不要信任任何一个用户</li>
<li>代码的逻辑</li>
</ul>
<h2 id="0x01_过滤输入">0x01 过滤输入</h2><h4 id="a-验证提交值是否为期望值或者允许值">a.验证提交值是否为期望值或者允许值</h4><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;<span class="keyword">form</span> action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">	&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"radio"</span> name=<span class="string">"gender"</span> value=<span class="string">"Male"</span>&gt;Male&lt;<span class="keyword">br</span>/&gt;</span><br><span class="line">	&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"radio"</span> name=<span class="string">"gender"</span> value=<span class="string">"Female"</span>&gt;Female&lt;<span class="keyword">br</span>/&gt;</span><br><span class="line">	&lt;<span class="keyword">input</span> <span class="keyword">type</span>=<span class="string">"submit"</span> name=<span class="string">"submit"</span> value=<span class="string">"submit"</span>&gt;&lt;<span class="keyword">br</span>/&gt;</span><br><span class="line">&lt;/<span class="keyword">form</span>&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">(a):</span><br><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"The user's gender is "</span>.<span class="variable">$_POST</span>[<span class="string">'gender'</span>].<span class="string">".&lt;br/&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br><span class="line">(b):</span><br><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_POST</span>))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">switch</span> (<span class="variable">$_POST</span>[<span class="string">'gender'</span>])</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'Male'</span>:</span><br><span class="line">		<span class="keyword">case</span> <span class="string">'Female'</span>:</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"The user's gender is "</span>.<span class="variable">$_POST</span>[<span class="string">'gender'</span>].<span class="string">".&lt;br/&gt;"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">default</span>:</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">"Invalid input value for gender specified.&lt;br/&gt;"</span>;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>比较一下(a)(b)两种后台验证 (b)显然确保了正确值 对于处理数据方面显然很重要</p>
<h4 id="b-确认提交类型是否为允许类型">b.确认提交类型是否为允许类型</h4><figure class="highlight xquery"><table><tr><td class="code"><pre><span class="line"><span class="variable">$number</span>_of_nights = (int)$_POST[’num_nights’];</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$num</span>_of_nights == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">     echo “Error: Invalied number of nights for the room”;</span><br><span class="line">     exit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种不仅能确认正确的输入 也可以改进系统的安全</p>
<h4 id="c-输入数据库的数据">c.输入数据库的数据</h4><ul>
<li>输入必须使用<code>addslashes()</code>函数 </li>
<li><code>stripslashes()</code>用来返回数据的原始形式</li>
<li>php.ini文件中开启<code>magic_quotes_gpc</code><strong>(格式化GET POST和cookie变量)</strong>和<code>magic_quotes_runtime</code><strong>(格式化进入数据库的数据)</strong> 自动添加和过滤斜杠</li>
</ul>
<h4 id="d-其他恶意输入">d.其他恶意输入</h4><ul>
<li>当用户传递数据给<code>system()</code>和<code>exec()</code>时 必须使用<code>escapeshellcmd()</code>避免任何恶意用户运行系统命令<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="preprocessor">&lt;?php</span></span><br><span class="line">	<span class="variable">$a</span> = escapeshellcmd(<span class="variable">$_GET</span>[<span class="string">'id'</span>]); <span class="comment">//1.php?id=sixwhale;ls</span></span><br><span class="line">	<span class="variable">$b</span> = <span class="variable">$_GET</span>[<span class="string">'id'</span>];</span><br><span class="line">	system(<span class="string">"echo $a"</span>);<span class="comment">//结果(1)</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="string">"&lt;p&gt;"</span>;</span><br><span class="line">	system(<span class="string">"echo $b"</span>);<span class="comment">//结果(2)</span></span><br><span class="line"><span class="preprocessor">?&gt;</span></span></span><br><span class="line"></span><br><span class="line">结果(1): sixwhale;ls</span><br><span class="line">结果(2): sixwhale 1.php(遍历当前目录下所有文件)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>;</code>在shell里是分割命令的作用 所以可想而知 只要改变<code>;</code>后的值就可以导致很多命令注入</p>
<ul>
<li><code>strip_tags()</code>去掉HTML和PHP标记 避免恶意脚本植入</li>
</ul>
<h2 id="0x02_转义输出">0x02 转义输出</h2><p>最常见的就是插入恶意的HTML代码 使用<code>htmlspecialchars()</code>或者<code>htmlentities()</code>函数</p>
<p><strong>……</strong></p>
<h2 id="0x03_(//∀//)">0x03 (//∀//)</h2><p>今天看到了PHP与web安全的部分 虽然之前在网上了解过 实践中也有接触 但是感觉还是自己总结笔记印象比较深刻(毕竟还是希望在博客里写一些对自己有用的东西!!!) 只写了一部分 不定期更新中 希望不要吐槽啦<strong>(இдஇ; )</strong></p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2015/12/03/php大法好—>安全的代码/" class="article-date">
  <time datetime="2015-12-03T11:45:06.000Z" itemprop="datePublished">2015-12-03</time>
</a>

        </li>
        
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2016/01/09/PHP集成环境搭建—>令人心碎的MAMP/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          PHP集成环境搭建—&gt;令人心碎的MAMP
        
      </div>
    </a>
  
  
    <a href="/2015/10/19/hexo+github+node.js/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">hexo+github+node.js搭建blog</div>
    </a>
  
</nav>


  
</article>


  <section id="comments" class="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>



      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>2015-2017 | ❤ I’m <a href="/about">sixwhale</a>, nice to meet you.</p>


      </div>
    </footer>
<script src="http://s11.cnzz.com/z_stat.php?id=1258121687&web_id=1258121687" language="JavaScript"></script>

      
  <script>
   var disqus_shortname = 'sixwhale';
   
   var disqus_url = 'http://yoursite.com/2015/12/03/php大法好—&gt;安全的代码/';
   
   (function(){
     var dsq = document.createElement('script');
     dsq.type = 'text/javascript';
     dsq.async = true;
     dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
   })();
  </script>


<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/typing.js" type="text/javascript"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
